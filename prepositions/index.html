<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prepositions Game</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/styles.css">
    <link rel="stylesheet" href="prepositions.css">
</head>
<body>
    <!-- Background Animation -->
    <div class="background-animation" id="background-animation"></div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Logo -->
        <div class="logo-container">
            <h1 class="game-logo">ğŸ“¦ Where Is It? ğŸ“¦</h1>
        </div>

        <!-- Game Card -->
        <div class="game-container">
            <div class="header">
                <h1>Find the Position!</h1>
                <p class="subtitle">Learn prepositions: in, on, under, beside</p>
            </div>

            <div id="score-container"></div>

            <div id="game-play">
                <div class="guess-layout">
                    <div class="single-card position-card" id="position-card">
                        <div class="position-display" id="position-display">
                            <div class="visual-display" id="visual-display"></div>
                        </div>
                        <div class="question-text" id="question-text">Where is the cat?</div>
                    </div>

                    <div class="answer-options" id="answer-options">
                        <!-- Answer pills will be dynamically inserted here -->
                    </div>
                </div>

                <div class="feedback">
                    <div class="feedback-message" id="feedback"></div>
                </div>

                <button class="next-button" id="next-button" onclick="nextRound()"><span>Next Round â†’</span></button>
            </div>
        </div>

        <a href="../index.html" class="back-link">â† Back to Menu</a>
    </div>

    <script src="../shared/components.js"></script>
    <script>
        const scenarios = [
            {
                object: 'cat',
                emoji: 'ğŸ±',
                container: 'box',
                containerEmoji: 'ğŸ“¦',
                preposition: 'in',
                visual: 'ğŸ“¦ğŸ±',
                sentence: 'The cat is IN the box'
            },
            {
                object: 'cat',
                emoji: 'ğŸ±',
                container: 'box',
                containerEmoji: 'ğŸ“¦',
                preposition: 'on',
                visual: 'ğŸ±\nğŸ“¦',
                sentence: 'The cat is ON the box'
            },
            {
                object: 'cat',
                emoji: 'ğŸ±',
                container: 'box',
                containerEmoji: 'ğŸ“¦',
                preposition: 'under',
                visual: 'ğŸ“¦\nğŸ±',
                sentence: 'The cat is UNDER the box'
            },
            {
                object: 'cat',
                emoji: 'ğŸ±',
                container: 'box',
                containerEmoji: 'ğŸ“¦',
                preposition: 'beside',
                visual: 'ğŸ“¦ ğŸ±',
                sentence: 'The cat is BESIDE the box'
            },
            {
                object: 'apple',
                emoji: 'ğŸ',
                container: 'table',
                containerEmoji: 'ğŸª‘',
                preposition: 'on',
                visual: 'ğŸ\nğŸª‘',
                sentence: 'The apple is ON the table'
            },
            {
                object: 'apple',
                emoji: 'ğŸ',
                container: 'table',
                containerEmoji: 'ğŸª‘',
                preposition: 'under',
                visual: 'ğŸª‘\nğŸ',
                sentence: 'The apple is UNDER the table'
            },
            {
                object: 'ball',
                emoji: 'âš½',
                container: 'chair',
                containerEmoji: 'ğŸª‘',
                preposition: 'on',
                visual: 'âš½\nğŸª‘',
                sentence: 'The ball is ON the chair'
            },
            {
                object: 'ball',
                emoji: 'âš½',
                container: 'chair',
                containerEmoji: 'ğŸª‘',
                preposition: 'under',
                visual: 'ğŸª‘\nâš½',
                sentence: 'The ball is UNDER the chair'
            },
            {
                object: 'book',
                emoji: 'ğŸ“š',
                container: 'desk',
                containerEmoji: 'ğŸª‘',
                preposition: 'on',
                visual: 'ğŸ“š\nğŸª‘',
                sentence: 'The book is ON the desk'
            },
            {
                object: 'bird',
                emoji: 'ğŸ¦',
                container: 'tree',
                containerEmoji: 'ğŸŒ³',
                preposition: 'in',
                visual: 'ğŸŒ³ğŸ¦',
                sentence: 'The bird is IN the tree'
            }
        ];

        const prepositions = ['in', 'on', 'under', 'beside'];

        let currentScenario = null;
        let streak = 0;
        let maxStreak = 0;
        let usedScenarios = new Set();
        let autoAdvanceTimer = null;

        const correctMessages = [
            "â­ Perfect! That's the right position!",
            "ğŸ‰ Excellent work!",
            "ğŸ‘ Amazing! You got it!",
            "ğŸŒŸ Yes! Great job!",
            "ğŸ’š Fantastic!",
            "ğŸŠ Brilliant!",
            "âœ¨ Correct!",
            "ğŸ† Outstanding!",
            "ğŸ’ª Well done!",
            "ğŸ¯ Spot on!"
        ];

        const incorrectMessages = [
            "ğŸ’­ Not quite! It's",
            "ğŸ¤” Good try! The answer is",
            "ğŸ“š Let's learn! The correct preposition is",
            "ğŸ’¡ Almost! It's actually",
            "ğŸŒ± Nice effort! It's",
            "ğŸ“ Keep learning! It's",
            "ğŸ” Not this time! The answer is",
            "ğŸ“– Don't worry! It's",
            "ğŸ§  Learning time! The correct answer is",
            "ğŸ’« Good guess! It's actually"
        ];

        function getRandomMessage(messages) {
            return messages[Math.floor(Math.random() * messages.length)];
        }

        function getRandomScenario() {
            let attempts = 0;
            while (attempts < 100) {
                const randomIndex = Math.floor(Math.random() * scenarios.length);
                const scenario = scenarios[randomIndex];
                const key = `${scenario.object}-${scenario.preposition}`;
                if (!usedScenarios.has(key)) {
                    usedScenarios.add(key);
                    return scenario;
                }
                attempts++;
            }
            usedScenarios.clear();
            return scenarios[Math.floor(Math.random() * scenarios.length)];
        }

        function getWrongPrepositions(correct) {
            return prepositions.filter(p => p !== correct);
        }

        function displayRound() {
            if (autoAdvanceTimer) {
                clearTimeout(autoAdvanceTimer);
                autoAdvanceTimer = null;
            }

            currentScenario = getRandomScenario();

            // Display visual
            const visualDisplay = document.getElementById('visual-display');
            visualDisplay.textContent = currentScenario.visual;

            // Display question
            document.getElementById('question-text').textContent =
                `Where is the ${currentScenario.object}?`;

            // Create answer options
            const optionsContainer = document.getElementById('answer-options');
            optionsContainer.innerHTML = '';

            const wrongPreps = getWrongPrepositions(currentScenario.preposition);
            const options = [currentScenario.preposition, wrongPreps[0], wrongPreps[1]];
            options.sort(() => Math.random() - 0.5);

            options.forEach(option => {
                const pill = document.createElement('button');
                pill.className = 'answer-pill';
                pill.textContent = option;
                pill.onclick = () => makeGuess(option);
                optionsContainer.appendChild(pill);
            });

            document.getElementById('position-card').classList.remove('correct', 'incorrect', 'disabled', 'fade-out', 'fade-in');
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('show', 'correct', 'incorrect');
            const nextButton = document.getElementById('next-button');
            nextButton.classList.remove('show', 'auto-advance');
        }

        function makeGuess(selectedPrep) {
            const pills = document.querySelectorAll('.answer-pill');
            const feedback = document.getElementById('feedback');
            const nextButton = document.getElementById('next-button');
            const positionCard = document.getElementById('position-card');

            pills.forEach(pill => pill.classList.add('disabled'));

            const isCorrect = selectedPrep === currentScenario.preposition;

            if (isCorrect) {
                streak++;
                if (streak > maxStreak) maxStreak = streak;

                feedback.innerHTML = `
                    <div>${getRandomMessage(correctMessages)}</div>
                    <div style="margin-top: 0.5rem;">${currentScenario.sentence}</div>
                `;
                feedback.classList.add('show', 'correct');
                positionCard.classList.add('correct');

                pills.forEach(pill => {
                    if (pill.textContent === selectedPrep) {
                        pill.classList.add('correct');
                    }
                });
            } else {
                streak = 0;

                feedback.innerHTML = `
                    <div>${getRandomMessage(incorrectMessages)} "${currentScenario.preposition}"</div>
                    <div style="margin-top: 0.5rem;">${currentScenario.sentence}</div>
                `;
                feedback.classList.add('show', 'incorrect');
                positionCard.classList.add('incorrect');

                pills.forEach(pill => {
                    if (pill.textContent === selectedPrep) {
                        pill.classList.add('incorrect');
                    } else if (pill.textContent === currentScenario.preposition) {
                        pill.classList.add('correct');
                    }
                });
            }

            document.getElementById('streak').textContent = streak;
            document.getElementById('max-streak').textContent = maxStreak;

            nextButton.classList.add('show');
            setTimeout(() => nextButton.classList.add('auto-advance'), 10);
            autoAdvanceTimer = setTimeout(() => nextRound(), 3500);
        }

        function nextRound() {
            const guessLayout = document.querySelector('.guess-layout');
            const feedback = document.getElementById('feedback');
            const nextButton = document.getElementById('next-button');

            guessLayout.classList.add('fade-out');
            feedback.classList.add('fade-out');
            nextButton.classList.add('fade-out');

            setTimeout(() => {
                feedback.classList.remove('fade-out');
                nextButton.classList.remove('fade-out');
                displayRound();

                setTimeout(() => {
                    guessLayout.classList.remove('fade-out');
                    guessLayout.classList.add('fade-in');
                    setTimeout(() => guessLayout.classList.remove('fade-in'), 400);
                }, 50);
            }, 300);
        }

        displayRound();
    </script>
</body>
</html>
