<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Words</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../shared/styles.css">
    <link rel="stylesheet" href="weather.css">
</head>
<body>
    <!-- Background Animation -->
    <div class="background-animation" id="background-animation"></div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Logo -->
        <div class="logo-container">
            <h1 class="game-logo">â˜€ï¸ Weather Words â˜ï¸</h1>
        </div>

        <!-- Game Card -->
        <div class="game-container">
            <div class="header">
                <h1>What's the Weather?</h1>
                <p class="subtitle">Learn weather words in English!</p>
            </div>

            <div id="score-container"></div>

            <div id="game-play">
                <div class="guess-layout">
                    <div class="single-card weather-card" id="weather-card">
                        <div class="weather-emoji" id="weather-emoji">â˜€ï¸</div>
                    </div>

                    <div class="answer-options" id="answer-options">
                        <!-- Answer pills will be dynamically inserted here -->
                    </div>
                </div>

                <div class="feedback">
                    <div class="feedback-message" id="feedback"></div>
                </div>

                <button class="next-button" id="next-button" onclick="nextRound()"><span>Next Round â†’</span></button>
            </div>
        </div>

        <a href="../index.html" class="back-link">â† Back to Menu</a>
    </div>

    <script src="../shared/components.js"></script>
    <script>
        const weatherTypes = [
            { word: 'sunny', emoji: 'â˜€ï¸', description: 'The sun is shining brightly!' },
            { word: 'rainy', emoji: 'ğŸŒ§ï¸', description: 'It\'s raining! Bring an umbrella!' },
            { word: 'cloudy', emoji: 'â˜ï¸', description: 'The sky is full of clouds!' },
            { word: 'snowy', emoji: 'â„ï¸', description: 'It\'s snowing! Time to play!' },
            { word: 'windy', emoji: 'ğŸ’¨', description: 'The wind is blowing strong!' },
            { word: 'stormy', emoji: 'â›ˆï¸', description: 'There\'s a storm with thunder!' },
            { word: 'foggy', emoji: 'ğŸŒ«ï¸', description: 'It\'s hard to see in the fog!' },
            { word: 'hot', emoji: 'ğŸ”¥', description: 'The weather is very hot!' },
            { word: 'cold', emoji: 'ğŸ¥¶', description: 'Brrr! It\'s very cold!' },
            { word: 'rainbow', emoji: 'ğŸŒˆ', description: 'A beautiful rainbow appears!' }
        ];

        let currentWeather = null;
        let streak = 0;
        let maxStreak = 0;
        let usedWeather = new Set();
        let autoAdvanceTimer = null;

        const correctMessages = [
            "â­ Perfect! That's the right weather!",
            "ğŸ‰ Excellent work!",
            "ğŸ‘ Amazing! You got it!",
            "ğŸŒŸ Yes! Great job!",
            "ğŸ’š Fantastic!",
            "ğŸŠ Brilliant!",
            "âœ¨ Correct!",
            "ğŸ† Outstanding!",
            "ğŸ’ª Well done!",
            "ğŸ¯ Spot on!"
        ];

        const incorrectMessages = [
            "ğŸ’­ Not quite! It's",
            "ğŸ¤” Good try! The answer is",
            "ğŸ“š Let's learn! The correct word is",
            "ğŸ’¡ Almost! It's actually",
            "ğŸŒ± Nice effort! It's",
            "ğŸ“ Keep learning! It's",
            "ğŸ” Not this time! The answer is",
            "ğŸ“– Don't worry! It's",
            "ğŸ§  Learning time! The answer is",
            "ğŸ’« Good guess! It's actually"
        ];

        function getRandomMessage(messages) {
            return messages[Math.floor(Math.random() * messages.length)];
        }

        function getRandomWeather() {
            let attempts = 0;
            while (attempts < 100) {
                const randomIndex = Math.floor(Math.random() * weatherTypes.length);
                const weather = weatherTypes[randomIndex];
                if (!usedWeather.has(weather.word)) {
                    usedWeather.add(weather.word);
                    return weather;
                }
                attempts++;
            }
            usedWeather.clear();
            return weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
        }

        function getWrongWeather(correct) {
            const wrong = [];
            while (wrong.length < 2) {
                const randomWeather = weatherTypes[Math.floor(Math.random() * weatherTypes.length)];
                if (randomWeather.word !== correct && !wrong.includes(randomWeather.word)) {
                    wrong.push(randomWeather.word);
                }
            }
            return wrong;
        }

        function displayRound() {
            if (autoAdvanceTimer) {
                clearTimeout(autoAdvanceTimer);
                autoAdvanceTimer = null;
            }

            currentWeather = getRandomWeather();

            document.getElementById('weather-emoji').textContent = currentWeather.emoji;

            // Create answer options
            const optionsContainer = document.getElementById('answer-options');
            optionsContainer.innerHTML = '';

            const wrongWords = getWrongWeather(currentWeather.word);
            const options = [currentWeather.word, ...wrongWords];
            options.sort(() => Math.random() - 0.5);

            options.forEach(option => {
                const pill = document.createElement('button');
                pill.className = 'answer-pill';
                pill.textContent = option;
                pill.onclick = () => makeGuess(option);
                optionsContainer.appendChild(pill);
            });

            document.getElementById('weather-card').classList.remove('correct', 'incorrect', 'disabled', 'fade-out', 'fade-in');
            const feedback = document.getElementById('feedback');
            feedback.classList.remove('show', 'correct', 'incorrect');
            const nextButton = document.getElementById('next-button');
            nextButton.classList.remove('show', 'auto-advance');
        }

        function makeGuess(selectedWord) {
            const pills = document.querySelectorAll('.answer-pill');
            const feedback = document.getElementById('feedback');
            const nextButton = document.getElementById('next-button');
            const weatherCard = document.getElementById('weather-card');

            pills.forEach(pill => pill.classList.add('disabled'));

            const isCorrect = selectedWord === currentWeather.word;

            if (isCorrect) {
                streak++;
                if (streak > maxStreak) maxStreak = streak;

                feedback.innerHTML = `
                    <div>${getRandomMessage(correctMessages)}</div>
                    <div style="margin-top: 0.5rem;">${currentWeather.emoji} = ${currentWeather.word}</div>
                    <div style="margin-top: 0.25rem; font-size: 0.9em;">${currentWeather.description}</div>
                `;
                feedback.classList.add('show', 'correct');
                weatherCard.classList.add('correct');

                pills.forEach(pill => {
                    if (pill.textContent === selectedWord) {
                        pill.classList.add('correct');
                    }
                });
            } else {
                streak = 0;

                feedback.innerHTML = `
                    <div>${getRandomMessage(incorrectMessages)} "${currentWeather.word}"</div>
                    <div style="margin-top: 0.5rem;">${currentWeather.emoji} = ${currentWeather.word}</div>
                    <div style="margin-top: 0.25rem; font-size: 0.9em;">${currentWeather.description}</div>
                `;
                feedback.classList.add('show', 'incorrect');
                weatherCard.classList.add('incorrect');

                pills.forEach(pill => {
                    if (pill.textContent === selectedWord) {
                        pill.classList.add('incorrect');
                    } else if (pill.textContent === currentWeather.word) {
                        pill.classList.add('correct');
                    }
                });
            }

            document.getElementById('streak').textContent = streak;
            document.getElementById('max-streak').textContent = maxStreak;

            nextButton.classList.add('show');
            setTimeout(() => nextButton.classList.add('auto-advance'), 10);
            autoAdvanceTimer = setTimeout(() => nextRound(), 3500);
        }

        function nextRound() {
            const guessLayout = document.querySelector('.guess-layout');
            const feedback = document.getElementById('feedback');
            const nextButton = document.getElementById('next-button');

            guessLayout.classList.add('fade-out');
            feedback.classList.add('fade-out');
            nextButton.classList.add('fade-out');

            setTimeout(() => {
                feedback.classList.remove('fade-out');
                nextButton.classList.remove('fade-out');
                displayRound();

                setTimeout(() => {
                    guessLayout.classList.remove('fade-out');
                    guessLayout.classList.add('fade-in');
                    setTimeout(() => guessLayout.classList.remove('fade-in'), 400);
                }, 50);
            }, 300);
        }

        displayRound();
    </script>
</body>
</html>
